<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emergency Debug Page</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
        .debug-box { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .error { background: #ffebee; border-left: 4px solid #f44336; }
        .success { background: #e8f5e8; border-left: 4px solid #4caf50; }
        .warning { background: #fff3e0; border-left: 4px solid #ff9800; }
        button { padding: 10px 20px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-danger { background: #f44336; color: white; }
        .btn-success { background: #4caf50; color: white; }
        .btn-warning { background: #ff9800; color: white; }
    </style>
</head>
<body>
    <h1>ðŸš¨ Emergency Debug Page</h1>
    <p><strong>This page has NO React, NO JavaScript that could cause loops</strong></p>

    <div class="debug-box error">
        <h3>Current Status</h3>
        <p><strong>URL:</strong> <span id="current-url"></span></p>
        <p><strong>Timestamp:</strong> <span id="timestamp"></span></p>
        <p><strong>User Agent:</strong> <span id="user-agent"></span></p>
        <p><strong>Referrer:</strong> <span id="referrer"></span></p>
    </div>

    <div class="debug-box warning">
        <h3>Storage Debug</h3>
        <p><strong>LocalStorage Items:</strong> <span id="local-storage"></span></p>
        <p><strong>SessionStorage Items:</strong> <span id="session-storage"></span></p>
        <p><strong>Cookies:</strong> <span id="cookies"></span></p>
    </div>

    <div class="debug-box success">
        <h3>Network Test</h3>
        <p><strong>API Health:</strong> <span id="api-status">Testing...</span></p>
        <p><strong>Response:</strong> <span id="api-response"></span></p>
    </div>

    <div class="debug-box">
        <h3>Actions</h3>
        <button class="btn-danger" onclick="clearAllData()">Clear All Data & Reload</button>
        <button class="btn-warning" onclick="testSignupDirect()">Test Direct Signup</button>
        <button class="btn-success" onclick="goToReactApp()">Go to React App</button>
        <button class="btn-warning" onclick="downloadDebugInfo()">Download Debug Info</button>
    </div>

    <div class="debug-box">
        <h3>Console Output</h3>
        <div id="console-output" style="background: #000; color: #0f0; padding: 10px; font-family: monospace; height: 200px; overflow-y: auto; border-radius: 4px;"></div>
    </div>

    <script>
        let consoleOutput = document.getElementById('console-output');
        
        function log(message) {
            consoleOutput.innerHTML += new Date().toISOString() + ': ' + message + '\n';
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
            console.log(message);
        }

        function updateInfo() {
            document.getElementById('current-url').textContent = window.location.href;
            document.getElementById('timestamp').textContent = new Date().toISOString();
            document.getElementById('user-agent').textContent = navigator.userAgent;
            document.getElementById('referrer').textContent = document.referrer || 'None';
            
            // Check storage
            const localKeys = Object.keys(localStorage);
            const sessionKeys = Object.keys(sessionStorage);
            document.getElementById('local-storage').textContent = localKeys.length + ' items: ' + localKeys.slice(0, 5).join(', ') + (localKeys.length > 5 ? '...' : '');
            document.getElementById('session-storage').textContent = sessionKeys.length + ' items: ' + sessionKeys.slice(0, 5).join(', ') + (sessionKeys.length > 5 ? '...' : '');
            document.getElementById('cookies').textContent = document.cookie ? 'Present' : 'None';
        }

        async function testApiHealth() {
            log('Testing API health...');
            try {
                const response = await fetch('https://contractnest-api-production.up.railway.app/health', {
                    method: 'GET',
                    mode: 'cors'
                });
                
                log('API Response Status: ' + response.status);
                const data = await response.text();
                document.getElementById('api-status').textContent = response.ok ? 'OK' : 'Error';
                document.getElementById('api-response').textContent = data.substring(0, 100);
                log('API Response: ' + data.substring(0, 200));
            } catch (error) {
                log('API Error: ' + error.message);
                document.getElementById('api-status').textContent = 'Failed';
                document.getElementById('api-response').textContent = error.message;
            }
        }

        function clearAllData() {
            log('Clearing all data...');
            localStorage.clear();
            sessionStorage.clear();
            
            // Clear cookies
            document.cookie.split(";").forEach(function(c) { 
                document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
            });
            
            log('All data cleared. Reloading...');
            setTimeout(() => window.location.reload(), 1000);
        }

        function testSignupDirect() {
            log('Testing direct signup navigation...');
            window.location.href = '/signup';
        }

        function goToReactApp() {
            log('Going to React app...');
            window.location.href = '/';
        }

        function downloadDebugInfo() {
            const info = {
                url: window.location.href,
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                referrer: document.referrer,
                localStorage: {...localStorage},
                sessionStorage: {...sessionStorage},
                cookies: document.cookie,
                consoleLog: consoleOutput.textContent
            };
            
            const blob = new Blob([JSON.stringify(info, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'debug-info-' + Date.now() + '.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Initialize
        updateInfo();
        testApiHealth();
        log('Emergency page loaded successfully');
        
        // Check for refresh loops
        let refreshCount = parseInt(localStorage.getItem('emergency_refresh_count') || '0') + 1;
        localStorage.setItem('emergency_refresh_count', refreshCount.toString());
        log('Emergency page load #' + refreshCount);
        
        if (refreshCount > 1) {
            log('ðŸš¨ EMERGENCY PAGE IS ALSO REFRESHING! Count: ' + refreshCount);
            document.body.style.background = '#ffcdd2';
        }
    </script>
</body>
</html>